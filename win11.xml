<domain type='kvm'>
	<name>win11</name>
	<memory unit='MiB'>16384</memory>
	<currentMemory unit='MiB'>16384</currentMemory>
	<vcpu placement='static'>12</vcpu>
	<os>
		<type arch='x86_64' machine='q35'>hvm</type>
		<loader readonly='yes' type='pflash'>/usr/share/OVMF/OVMF_CODE.fd</loader>
		<nvram>/var/lib/libvirt/nvram/win11_VARS.fd</nvram>
		<boot dev='cdrom'/>
		<boot dev='hd'/>
	</os>
	<features>
		<acpi/>
		<apic/>
		<hyperv>
			<relaxed state='on'/>
			<vapic state='on'/>
			<spinlocks state='on' retries='8191'/>
		</hyperv>
		<vmport state='off'/>
	</features>
	<cpu mode='host-passthrough' check='none'/>
	<clock offset='localtime'>
		<timer name='hypervclock' present='yes'/>
		<timer name='hpet' present='no'/>
	</clock>
	<devices>
		<!-- Add a disk for the OS installation -->
		<disk type='file' device='disk'>
			<driver name='qemu' type='qcow2'/>
			<source file='/var/lib/libvirt/images/win11.qcow2'/>
			<target dev='vda' bus='virtio'/>
		</disk>

		<!-- Windows ISO -->
		<disk type='file' device='cdrom'>
			<driver name='qemu' type='raw'/>
			<source file='/home/parking/Documents/kvm-article/Win11_23H2_French_x64v2.iso'/>
			<target dev='sda' bus='sata'/>
			<readonly/>
		</disk>

		<!-- VirtIO Drivers ISO -->
		<disk type='file' device='cdrom'>
			<driver name='qemu' type='raw'/>
			<source file='/home/parking/Documents/kvm-article/virtio-win-0.1.240.iso'/>
			<target dev='sdb' bus='sata'/>
			<readonly/>
		</disk>

		<!-- PCI GPU Video -->
		<hostdev mode='subsystem' type='pci' managed='yes'>
			<source>
				<address domain='0x0000' bus='0x01' slot='0x00' function='0x0'/>
			</source>
			<address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>
		</hostdev>

		<!-- PCI GPU Audio -->
		<hostdev mode='subsystem' type='pci' managed='yes'>
			<source>
				<address domain='0x0000' bus='0x01' slot='0x00' function='0x1'/>
			</source>
			<address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>
		</hostdev>

		<!-- PCI SSD Controller -->
		<hostdev mode='subsystem' type='pci' managed='yes'>
			<source>
				<address domain='0x0000' bus='0x00' slot='0x17' function='0x0'/>
			</source>
			<address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>
		</hostdev>

		<!-- Input and USB Devices -->
		<input type='tablet' bus='usb'/>
		<input type='mouse' bus='ps2'/>
		<input type='keyboard' bus='ps2'/>
		<controller type='usb' model='qemu-xhci' ports='15'/>
		
		<!-- Add a network interface -->
		<interface type='network'>
			<source network='default'/>
			<model type='virtio'/>
		</interface>

		<graphics type='vnc' port='-1' autoport='yes' listen='0.0.0.0'>
			<listen type='address' address='0.0.0.0'/>
		</graphics>

		<video>
			<model type='none'/> <!-- Remove QXL when passing through GPU -->
		</video>
	</devices>
</domain>
